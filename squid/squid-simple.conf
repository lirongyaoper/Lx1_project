# ============================================
# Squid 简化配置文件
# 适用于：远程代理服务器
# 端口：3128
# ============================================

# 1. 网络配置
# --------------------------------------------
# 监听端口（默认3128）
http_port 3128

# 2. 访问控制列表（ACL）定义
# --------------------------------------------
# 定义本地网络（根据您的实际情况修改）
acl localnet src 10.0.0.0/8          # RFC 1918 内网
acl localnet src 172.16.0.0/12       # RFC 1918 内网
acl localnet src 192.168.0.0/16      # RFC 1918 内网

# 允许所有IP访问（因为本地是动态IP）
# ⚠️ 安全提醒：此配置允许任何人使用代理，建议配合防火墙或改用认证方式
acl all_clients src 0.0.0.0/0

# 如果本地IP固定，建议改为限制特定IP（更安全）：
# acl allowed_clients src 您的本地公网IP/32
# http_access allow allowed_clients

# 定义安全端口
acl SSL_ports port 443
acl Safe_ports port 80              # http
acl Safe_ports port 21              # ftp
acl Safe_ports port 443             # https
acl Safe_ports port 70              # gopher
acl Safe_ports port 210             # wais
acl Safe_ports port 1025-65535      # 未注册端口
acl Safe_ports port 280             # http-mgmt
acl Safe_ports port 488             # gss-http
acl Safe_ports port 591             # filemaker
acl Safe_ports port 777             # multiling http

acl CONNECT method CONNECT

# 3. 访问控制规则
# --------------------------------------------
# 拒绝不安全端口的请求
http_access deny !Safe_ports

# 拒绝CONNECT到非SSL端口
http_access deny CONNECT !SSL_ports

# 允许本地管理
http_access allow localhost manager
http_access deny manager

# 允许本地访问
http_access allow localhost

# 允许所有客户端访问（因为本地是动态IP）
http_access allow all_clients

# 拒绝其他所有访问
http_access deny all

# 4. 缓存配置
# --------------------------------------------
# 缓存目录（大小：100MB，16个一级目录，256个二级目录）
cache_dir ufs /var/spool/squid 100 16 256

# 内存缓存大小
cache_mem 256 MB

# 最大对象大小
maximum_object_size 4 MB

# 最小对象大小
minimum_object_size 0 KB

# 5. 日志配置
# --------------------------------------------
# 访问日志
access_log /var/log/squid/access.log squid

# 缓存日志
cache_log /var/log/squid/cache.log

# 缓存存储日志
cache_store_log /var/log/squid/store.log

# 6. 性能优化
# --------------------------------------------
# DNS配置
dns_nameservers 8.8.8.8 8.8.4.4

# 刷新模式
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

# 7. 其他配置
# --------------------------------------------
# 主机名
visible_hostname proxy-154.12.95.232

# Coredump目录
coredump_dir /var/spool/squid

# 转发循环检测
forwarded_for on

# 隐藏客户端IP（可选）
# forwarded_for off
# request_header_access X-Forwarded-For deny all

